<!-- templates/nominate.html -->
{% extends 'base.html' %}
{% block title %}Nominate{% endblock %}
{% block content %}
<div class="w3-container">
    <div class="w3-bar w3-black w3-margin-bottom">
        <a href="{{ url_for('index') }}" class="w3-bar-item w3-button">
            <i class="fa fa-home"></i> Home
        </a>
        <div class="w3-right">
            <form action="{{ url_for('logout') }}" method="post" style="display: inline;">
                <button type="submit" class="w3-bar-item w3-button w3-red">Logout</button>
            </form>
        </div>
    </div>

    {% set house_logos = {
    'Boek': url_for('static', filename='boek.png'),
    'Gladius': url_for('static', filename='gladius.png'),
    'Mitre': url_for('static', filename='mitre.png'),
    'Scudo': url_for('static', filename='scudo.png'),
    'Taja': url_for('static', filename='taja.png')
} %}
<img src="{{ house_logos.get(house, '') }}" alt="{{ house }} Logo" style="height:100px; margin-bottom:10px;">
        <p class="w3-text-grey">Student ID: {{ username }}</p>
        <p class="w3-text-grey">
            Gender: {{ gender }} &nbsp;|&nbsp;
            Year Level: {{ year_level }}
        </p>
    </div>

    <h2 class="w3-text-blue">Nominate for Events</h2>
    <form method="post" class="w3-container w3-card-4 w3-padding w3-margin-bottom">
        <label>Select Event</label><br>
        <select name="event" required class="w3-select w3-border">
            {% for event, limit in event_limits.items() %}
                {% set count = event_counts.get(event, 0) %}
                {% set user_count = user_event_counts.get(event, 0) %}
                <option value="{{ event }}"
                    {% if count >= limit or user_count > 0 %}disabled{% endif %}>
                    {{ event }} ({{ count }}/{{ limit }})
                    {% if user_count > 0 %}- Already Nominated{% elif count >= limit %}- Full{% endif %}
                </option>
            {% endfor %}
        </select><br>
        <button type="submit" class="w3-button w3-blue w3-margin-top">Submit Nomination</button>
    </form>

    <h3 class="w3-text-blue">Your Nominations</h3>
    <ul class="w3-ul w3-card-4">
        {% for nomination in user_nominations %}
            <li class="w3-bar">
                <span class="w3-bar-item">{{ nomination.event }}</span>
                <form method="post" action="{{ url_for('remove_nomination', nomination_id=nomination.nomination_id) }}" style="display:inline;" class="w3-bar-item w3-right">
                    <button type="submit" class="w3-button w3-red w3-small" title="Remove">âœ–</button>
                </form>
            </li>
        {% else %}
            <li class="w3-bar">No nominations yet.</li>
        {% endfor %}
    </ul>
</div>

{% if user_nominations|length == event_limits|length %}
    <p class="w3-text-green w3-large w3-center w3-margin-top">
        <i class="fa fa-star"></i> Thank you for your outstanding participation and bravery!
    </p>
{% endif %}
{% endblock %}